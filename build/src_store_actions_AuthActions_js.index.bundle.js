"use strict";
/*
 * ATTENTION: The "eval" devtool has been used (maybe by default in mode: "development").
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(self["webpackChunkflowtrade"] = self["webpackChunkflowtrade"] || []).push([["src_store_actions_AuthActions_js"],{

/***/ "./src/store/actions/AuthActions.js":
/*!******************************************!*\
  !*** ./src/store/actions/AuthActions.js ***!
  \******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"signIn\": () => (/* binding */ signIn),\n/* harmony export */   \"signUp\": () => (/* binding */ signUp),\n/* harmony export */   \"signOut\": () => (/* binding */ signOut),\n/* harmony export */   \"processPayment\": () => (/* binding */ processPayment)\n/* harmony export */ });\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }\n\nfunction _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err); } _next(undefined); }); }; }\n\nvar signIn = function signIn(credentials) {\n  return function (dispatch, getState, _ref) {\n    var getFirebase = _ref.getFirebase;\n    var firebase = getFirebase();\n    dispatch({\n      type: 'RESET'\n    });\n    dispatch({\n      type: 'PROGRESS_IN'\n    });\n    firebase.auth().signInWithEmailAndPassword(credentials.email, credentials.password).then(function () {\n      dispatch({\n        type: 'LOGIN_SUCCESS'\n      });\n    })[\"catch\"](function (err) {\n      dispatch({\n        type: 'LOGIN_ERROR',\n        err: err\n      });\n    })[\"finally\"](function () {\n      dispatch({\n        type: 'PROGRESS_OUT'\n      });\n    });\n  };\n};\nvar signUp = function signUp(credentials, userData) {\n  return function (dispatch, getState, _ref2) {\n    var getFirebase = _ref2.getFirebase;\n    var firebase = getFirebase();\n    dispatch({\n      type: 'RESET'\n    });\n    dispatch({\n      type: 'SIGNUP_PROGRESS_IN'\n    });\n    firebase.auth().createUserWithEmailAndPassword(credentials.email, credentials.password).then( /*#__PURE__*/function () {\n      var _ref3 = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee(userCredential) {\n        return regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                delete userData.password;\n                delete userData.verification;\n                delete userData.signupComplete;\n                delete userData.createdUser;\n                delete userData.progress;\n                delete userData.validUserName;\n                _context.next = 8;\n                return firebase.database().ref(\"users/\".concat(userCredential.user.uid)).set(userData);\n\n              case 8:\n                if (userData.utmSource !== '') {\n                  firebase.analytics().logEvent('utm_purchase');\n                }\n\n                dispatch({\n                  type: 'SIGNUP_SUCCESS',\n                  userCredential: userCredential\n                });\n\n              case 10:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      return function (_x) {\n        return _ref3.apply(this, arguments);\n      };\n    }())[\"catch\"](function (err) {\n      dispatch({\n        type: 'SIGNUP_ERROR',\n        err: err\n      });\n    })[\"finally\"](function () {\n      dispatch({\n        type: 'SIGNUP_PROGRESS_OUT'\n      });\n    });\n  };\n};\nvar signOut = function signOut() {\n  return function (dispatch, getState, _ref4) {\n    var getFirebase = _ref4.getFirebase;\n    var firebase = getFirebase();\n    dispatch({\n      type: 'PROGRESS_IN'\n    });\n    firebase.auth().signOut().then(function () {\n      firebase.logout();\n    })[\"finally\"](function () {\n      dispatch({\n        type: 'PROGRESS_OUT'\n      });\n      dispatch({\n        type: 'RESET_ACTION'\n      });\n    });\n  };\n};\nvar processPayment = function processPayment(stripe, elements, userPayload) {\n  return /*#__PURE__*/function () {\n    var _ref6 = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2(dispatch, getState, _ref5) {\n      var getFirebase, firebase, credentials, cardHolderName, email;\n      return regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              getFirebase = _ref5.getFirebase;\n              dispatch({\n                type: 'PAYMENT_PROGRESS_IN'\n              });\n              firebase = getFirebase();\n              credentials = getState().auth.signedUpCredentials;\n              cardHolderName = userPayload.firstName + ' ' + userPayload.lastName, email = userPayload.email;\n\n              try {\n                firebase.database().ref(\"users/\".concat(credentials.user.uid, \"/checkoutClicked\")).push(true);\n              } catch (ex) {}\n\n              try {\n                stripe.createToken(elements.getElement('card'), {\n                  name: cardHolderName\n                }).then(function (result) {\n                  if (result.token) {\n                    stripe.createPaymentMethod({\n                      type: 'card',\n                      card: elements.getElement('card'),\n                      billing_details: {\n                        email: email,\n                        name: cardHolderName\n                      }\n                    }).then(function (presult) {\n                      if (presult.paymentMethod) {\n                        var user = credentials.user;\n\n                        try {\n                          window.fetch('https://us-central1-tradingproject19-f513b.cloudfunctions.net/CreatePaymentMethodB', {\n                            method: 'POST',\n                            mode: 'cors',\n                            headers: {\n                              'Content-Type': 'application/json'\n                            },\n                            body: JSON.stringify({\n                              token: result.token,\n                              plan: 'Trial',\n                              email: email,\n                              name: cardHolderName,\n                              payment_method_id: presult.paymentMethod.id,\n                              uid: user.uid,\n                              isTestCard: true,\n                              user: userPayload\n                            })\n                          }).then(function (res) {\n                            if (res.status === 200) {\n                              return res.json();\n                            } else {\n                              firebase.database().ref(\"CheckoutErrors/\".concat(user.uid)).push(res.status);\n                              dispatch({\n                                type: 'PAYMENT_ERROR'\n                              });\n                              return null;\n                            }\n                          }).then(function (data) {\n                            if (data && data.err) {\n                              var err = data.err;\n                              firebase.database().ref(\"CheckoutErrors/\".concat(user.uid)).push(err);\n                              dispatch({\n                                type: 'PAYMENT_ERROR',\n                                err: err\n                              });\n                            } else {\n                              if (userPayload.fromCancel == true) {\n                                firebase.database().ref(\"users/\".concat(user.uid, \"/futureCancel\")).remove();\n                                firebase.database().ref(\"users/\".concat(user.uid, \"/billingFailed\")).remove();\n                                firebase.database().ref(\"users/\".concat(user.uid, \"/cancelTime\")).remove();\n                                firebase.database().ref(\"users/\".concat(user.uid, \"/cancelling\")).remove();\n                                firebase.database().ref(\"users/\".concat(user.uid, \"/paypalBA\")).remove();\n                                firebase.database().ref(\"users/\".concat(user.uid, \"/paypal\")).remove();\n                                firebase.database().ref(\"users/\".concat(user.uid, \"/paypalSub\")).remove();\n                              }\n\n                              firebase.database().ref(\"users/\".concat(user.uid, \"/cancelTime\")).remove();\n                              firebase.database().ref(\"users/\".concat(user.uid, \"/cancelling\")).remove();\n                              firebase.database().ref(\"users/\".concat(user.uid, \"/paymentDate\")).set(new Date().getTime());\n                              firebase.database().ref(\"users/\".concat(user.uid, \"/stripe\")).set(true);\n                              firebase.database().ref(\"users/\".concat(user.uid, \"/paymentStatus\")).set('Paid');\n\n                              try {\n                                window.fetch('https://us-central1-vwo-flowtrade.cloudfunctions.net/AddLeadActiveCampaign', {\n                                  method: 'POST',\n                                  mode: 'cors',\n                                  headers: {\n                                    'Content-Type': 'application/json'\n                                  },\n                                  body: JSON.stringify({\n                                    fname: userPayload.firstName || '',\n                                    lname: userPayload.lastName || '',\n                                    phone: userPayload.phoneNumber || '',\n                                    address: userPayload.address || '',\n                                    city: userPayload.city || '',\n                                    state: userPayload.state || '',\n                                    zip: userPayload.zip || '',\n                                    country: userPayload.country || '',\n                                    email: userPayload.email || '',\n                                    listID: userPayload.utmList || 19,\n                                    tags: 'Free-Trial'\n                                  })\n                                }).then(function (res) {\n                                  if (res.status === 200) {\n                                    return res.json();\n                                  } else {\n                                    return null;\n                                  }\n                                }).then(function (data) {\n                                  var subscriber_id;\n\n                                  if (typeof data['response'][0] !== 'undefined') {\n                                    subscriber_id = data['response'][0]['id'];\n                                  } else {\n                                    subscriber_id = data['response']['subscriber_id'];\n                                  }\n                                });\n                              } catch (err) {}\n\n                              var sendSubscribeSuccess = firebase.functions().httpsCallable('sendSubscribeSuccess');\n                              dispatch({\n                                type: 'PAYMENT_SUCCESS'\n                              });\n                            }\n                          });\n                        } catch (err) {\n                          dispatch({\n                            type: 'PAYMENT_ERROR',\n                            err: err\n                          });\n                        }\n                      } else {\n                        dispatch({\n                          type: 'PAYMENT_ERROR'\n                        });\n                      }\n                    });\n                  } else {\n                    dispatch({\n                      type: 'PAYMENT_ERROR'\n                    });\n                  }\n                });\n              } catch (err) {\n                dispatch({\n                  type: 'PAYMENT_ERROR',\n                  err: err\n                });\n              }\n\n            case 7:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function (_x2, _x3, _x4) {\n      return _ref6.apply(this, arguments);\n    };\n  }();\n};\n\n//# sourceURL=webpack://flowtrade/./src/store/actions/AuthActions.js?");

/***/ })

}]);